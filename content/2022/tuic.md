+++
title = "基于 QUIC 的代理软件：TUIC"
date = 2022-03-10

[extra.comments]
issue_id = 51

[[extra.comments.addition]]
user = { login = "est", html_url = "https://blog.est.im/", avatar_url = "https://secure.gravatar.com/avatar/a1e570c0195f7dfead850afe83a62d43?d=retro" }
created_at = "2022-11-12T00:26:21Z"
body = "其实1根连接并不是什么好事呀。网络流量分析直接拿1个连接就能metadata 分析所有数据，其实最好的方式是M:N 连接。因为每一个网络包的路由都会稍微不同，所以中间商拿不到正确时序的完整数据，流量特征不好确定。如果家宽有多路 ISP 还可以做带宽聚合更加安全。"

[[extra.comments.addition]]
user = { login = "土匪大哥哥", avatar_url = "https://secure.gravatar.com/avatar/2c7f9543656ed24beddb3e3f0b1d02a4?d=retro" }
created_at = "2023-05-24T09:14:30Z"
body = "文中的协议说明在哪里呢？链接跳过去没有了？"

[[extra.comments.addition]]
user = { login = "chika0801", avatar_url = "https://secure.gravatar.com/avatar/8781669f273f9fcde73a8879ed82337f?d=retro" }
created_at = "2023-06-08T08:55:50Z"
body = "恭喜 1.0.0 版本更新，新版本太快了，感谢作者，没想到你在回iss时的一句会重构，一等半年多时间，终于做出来了。再次感谢。"

[[extra.comments.addition]]
user = { login = "aua", avatar_url = "https://secure.gravatar.com/avatar/?d=retro" }
created_at = "2022-12-06T10:34:26Z"
body = "当这类项目拥有一定热度后，开发者一定会成为众矢之的\n为了安全考虑也是为了这个项目，建议使用新账号（割裂身份相关）等方式去维护、更新、发布TUIC项目并清除能够明确身份相关的博客等内容\n一但第一维护者倒下后，TUIC很可能变成各个克隆仓库各自为阵的局面，对于用户来说太痛苦了。"

[[extra.comments.addition]]
user = { login = "ortt", avatar_url = "https://secure.gravatar.com/avatar/867ae57702dd9d4ebd40b2977e63497e?d=retro" }
created_at = "2023-02-23T12:38:24Z"
body = "多谢大佬"

[[extra.comments.addition]]
user = { login = "Senpai", avatar_url = "https://secure.gravatar.com/avatar/e4638187ba10c88590cfcfae42345bed?d=retro" }
created_at = "2022-11-28T07:20:59Z"
body = "从你其他文章来看，似乎还是大学生。不怕被喝茶吗"

[[extra.comments.addition]]
user = { login = "凡尘", avatar_url = "https://secure.gravatar.com/avatar/60704096935c4f6f73bd6c7c862c4c2b?d=retro" }
created_at = "2022-03-24T22:53:29Z"
body = "这个还是很有用的"

[[extra.comments.addition]]
user = { login = "Falcon55", avatar_url = "https://secure.gravatar.com/avatar/a53e0f259c78a55c07dac3ff88b83726?d=retro" }
created_at = "2022-11-29T09:43:37Z"
body = "请问博主有一些搭建教程么 外行人看了半天有点搞不明白 谢谢"

[[extra.comments.addition]]
user = { login = "JL", avatar_url = "https://secure.gravatar.com/avatar/e7f4ba495d590ea37b927bf9a1a55626?d=retro" }
created_at = "2022-03-22T08:08:42Z"
body = "谢谢博主！\n已经用上啦！但是quic会遇到一些qos的问题。\n请问大佬有兴趣看一下这个项目嘛：\nhttps://github.com/Qv2ray/v2ray-rust\n希望共同努力！祝安好！"

[[extra.comments.addition]]
user = { login = "ken", avatar_url = "https://secure.gravatar.com/avatar/1e8d4626f39fbc932b0c15e2a2a36701?d=retro" }
created_at = "2023-02-10T13:12:00Z"
body = "能否在服务器端增加sock5出口设置以便对接*ray的routing分流设置？"

[[extra.comments.addition]]
user = { login = "hhhhux", avatar_url = "https://secure.gravatar.com/avatar/4f1972d813fe58aa6e295fd4aee88220?d=retro" }
created_at = "2023-03-31T23:53:36Z"
body = "佬留个捐赠地址，给你点动力"

[[extra.comments.addition]]
user = { login = "我是我", html_url = "http://www.902mix.co", avatar_url = "https://secure.gravatar.com/avatar/826409d4033fee2ffbc2adcae6d111f7?d=retro" }
created_at = "2022-11-18T21:33:17Z"
body = "仓库里没有apk文件 下载下来自己手动改吗 还是？"

[[extra.comments.addition]]
user = { login = "😂……", avatar_url = "https://secure.gravatar.com/avatar/c0b96917e374b46d9b4be632373c517d?d=retro" }
created_at = "2023-02-09T03:01:40Z"
body = "> 很快  在移动下也没有qos问题  始终满速300mbps\n\n不知道断流问题有没有解决"

[[extra.comments.addition]]
user = { login = "molezz", html_url = "https://molezz.net", avatar_url = "https://secure.gravatar.com/avatar/f60a5fd549dbbee276b7bdabe22a2bff?d=retro" }
created_at = "2023-01-31T15:53:36Z"
body = "很快  在移动下也没有qos问题  始终满速300mbps"

[[extra.comments.addition]]
user = { login = "嘿嘿嘿", avatar_url = "https://secure.gravatar.com/avatar/0740791abe229e13d9438b582a57f176?d=retro" }
created_at = "2022-11-06T16:43:57Z"
body = "用上了，很好用啊。用的白嫖的Azure的香港机，在广东晚高峰稳定youtube在10万左右，暂时没有被qos。点赞。现在在想是不是要部署个网站之类的。。"

[[extra.comments.addition]]
user = { login = "Escher", html_url = "https://jkgblog.com", avatar_url = "https://secure.gravatar.com/avatar/731441c6ac9b290ab1c7423972dc6764?d=retro" }
created_at = "2022-03-24T01:42:00Z"
body = "已经在使用着，感谢工具，我会及时issues"

[[extra.comments.addition]]
user = { login = "佚名", avatar_url = "https://secure.gravatar.com/avatar/9f5377a83fec2c41721f78189d209cab?d=retro" }
created_at = "2023-03-22T08:42:29Z"
body = "git上连个配置模板都没有也没有wiki。。。"

[[extra.comments.addition]]
user = { login = "嘻→嘻↘嘻↗嘻↗嘻↘", avatar_url = "https://secure.gravatar.com/avatar/bd918941db2e7c88bec4e27012d589e3?d=retro" }
created_at = "2023-02-12T13:51:32Z"
body = "现在client还是不能长时间挂着连接，会掉线，需要即用即连，不太方便。"
+++

QUIC 协议汲取了大量人们给 TCP 糊墙的经验教训，把连接结构优化到（目前来看）极致。但是现在市面上的代理工具还没有能完全利用 QUIC 特性的存在，所以我自己动手写了一个基于 QUIC 协议的新代理工具：TUIC

https://github.com/EAimTY/tuic

- 1-RTT TCP 中继
- 0-RTT UDP 中继，且 NAT 类型为 FullCone
- 在用户空间的拥塞控制，也就是说可以在任何系统平台实现双向的 BBR
- 两种 UDP 中继模式: native （原生 UDP 特性，数据仍被 TLS 加密）和 quic (100% 送达率，每个包单独单独作为一个 QUIC “流”，一个包的确认重传不会阻塞其它包)
- 完全多路复用，服务器和客户端之间始终只需要一条 QUIC 连接，所有任务作为这个连接中的 “流” 进行传输（一个流的暂时阻塞不会影响其它流），所以除连接第一个中继任务外的其它任务都不需要经过 QUIC 握手和 TUIC 的鉴权
- 网络切换时的会话平滑转移，例如在从 Wi-Fi 切换到移动数据时连接不会像 TCP 一样直接断开
- 0-RTT 、与中继任务并行的鉴权
- 支持 QUIC 的 0-RTT 握手（开启之后能达到 真・1-RTT TCP 和 0-RTT UDP ，但是就算不开启，多路复用的特性也能保证在绝大多数情况下 1-RTT 和 0-RTT ）

TUIC 的设计介绍在仓库中 [Design](https://github.com/EAimTY/tuic#design) 一节有说明。TUIC 协议的详细内容在[这里](https://github.com/EAimTY/tuic/tree/master/protocol)。简单来说，TUIC 的设计核心就是减少握手造成的网络往返时延（ rtt ），毕竟对于网络程序这是最大的瓶颈。

对比其它使用 TCP 的代理工具（ ss 、v2ray 、trojan ），TCP 握手慢，且不支持自定义拥塞控制，各工具对 UDP 的支持也各有问题。对比 [Hysteria](https://github.com/HyNetwork/hysteria) ，Hysteria 的 UDP 中继需要 1 rtt 的握手，且只支持一种 UDP 模式。

最后说说安全性和协议特征。TUIC 现在基于原生 QUIC ，不支持 obfs ，但 QUIC 连接本身就是 TLS 加密的，每个 QUIC 连接从外面看都是一样的。国内的各大厂也慢慢开始使用 QUIC 了，所以我觉得 QUIC 特征应该不是什么大问题。
